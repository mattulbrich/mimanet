 Microprogram for the MIMA

 Lines starting with $ define "bits" (<control_bit> = <number in word>)
 Lines starting with : define steps
 Lines starting with # define labels
 Lines starting with = define an address where to write
 Other lines are ignored

 0 is the reset line

 Not all instructions have been implemented ... the rest seems clear

$ s_accu = 8
$ d_accu = 9
$ s_iar = 10
$ d_iar = 11
$ s_adr = 12
$ ram_r = 13
$ ram_w = 14
$ d_ram = 15
$ s_ram = 16
$ d_ramval = 17
$ s_ramval = 18
$ s_rx = 19
$ s_ry = 20
$ d_alu = 21
$ s_ir = 22
$ d_ir = 23
$ alu0 = 24
$ alu1 = 25
$ alu2 = 26
$ alu3 = 27

$ jmp = 28
$ instr_load = 29

= 0
: s_iar alu0 alu1 alu2 d_alu
  This means writing "0" (ALU=7) to IAR

= 1
#fetch
: d_iar s_adr ram_r
#fetch2
: alu3 d_alu s_ry ram_r
: d_iar s_rx ram_r
: d_alu s_iar ram_r s_ramval
: ram_r s_ramval d_ram s_ir
: instr_load #table

= 0x18
 JMN must be positive address. ... Will rearrange later anyway
#jmn
: d_iar s_adr ram_r #fetch2
  In case of positive: go fetch
: d_ir s_iar #fetch
  In case of negatvie: overwrite iar and fetch

= 0x20
#table
 Here is the instruction lookup table
 
 HALT
#halt
: #halt

 NOT
: d_accu s_rx #not

= 0x30
 LDC:
: d_ir s_accu #fetch

 LDV:
: d_ir s_adr ram_r #ldv

 STV:
: d_ir s_adr #stv

 ADD:
: d_ir s_adr ram_r #add

 AND:
: d_ir s_adr ram_r #and

 OR:
: d_ir s_adr ram_r #or

 XOR:
: d_ir s_adr ram_r #xor

 EQL:
: d_ir s_adr ram_r #eql

 JMP:
: d_ir s_iar #fetch

 JMN:
: #jmn jmp

 LDIV:
: d_ir s_adr ram_r #ldiv

 STIV:
: d_ir s_adr ram_r #stiv

= 0x40
#not
: alu2 alu1 d_alu s_accu #fetch

#ldv
: ram_r
: ram_r
: ram_r s_ramval
: d_ram s_accu #fetch

#stv
: d_accu s_ram d_ramval ram_w
: d_ramval ram_w
: d_ramval ram_w
: d_ramval #fetch

#add
: ram_r
: d_accu s_rx ram_r
: ram_r s_ramval
: d_ram s_ry 
: d_alu s_accu #fetch
 Adding is alu mode 0

#and
: ram_r
: d_accu s_rx ram_r
: ram_r s_ramval
: d_ram s_ry 
: alu0 alu1 d_alu s_accu #fetch
 Adding is alu mode 3

#or
: ram_r
: d_accu s_rx ram_r
: ram_r s_ramval
: d_ram s_ry 
: alu2 d_alu s_accu #fetch
 Adding is alu mode 4

#xor
: ram_r
: d_accu s_rx ram_r
: ram_r s_ramval
: d_ram s_ry 
: alu2 alu0 d_alu s_accu #fetch
 Adding is alu mode 5

#eql
: ram_r
: d_accu s_rx ram_r
: ram_r s_ramval
: d_ram s_ry 
: alu0 d_alu s_accu #fetch
 Adding is alu mode 1

#ldiv
: ram_r
: ram_r
: ram_r s_ramval
: d_ram s_adr
: ram_r
: ram_r
: ram_r
: ram_r s_ramval
: d_ram s_accu #fetch

#stiv
: ram_r d_accu s_ram
: ram_r
: ram_r s_ramval
: d_ram s_adr
: d_ramval ram_w 
: d_ramval ram_w
: d_ramval ram_w
: d_ramval #fetch
